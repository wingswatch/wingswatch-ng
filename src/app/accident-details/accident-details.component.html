<div class="container">
  <div class="page-wrap">
    <h3>
      Accident Details - {{ eventId }}
    </h3>

    <p>
      <small><a [routerLink]="['/accidents']">&lt;- Back to Accident List</a></small>
    </p>

    <div *ngIf="!accident">
      <app-svg-spinner></app-svg-spinner>
    </div>

    <div *ngIf="accident">

      <table class='table table-striped'>
        <tr>
          <td>
            <b>Location</b>
          </td>
          <td>
            {{ accident.location }}
        </td>
        <td><b>Accident Number</b></td>
        <td>
          {{ accident.accidentNumber }}
        </td>
        </tr>
        <tr>
          <td><b>Date</b></td>
          <td>{{ accident.eventDate | date:'MM/dd/yyyy' }}</td>
          <td><b>Registration</b></td>
          <td> {{ aircraft.registrationNumber }}</td>
        </tr>
        <tr>
          <td><b>Aircraft</b></td>
          <td>{{ aircraft.make }} {{ aircraft.model }}</td>
          <td><b>Aircraft Damage</b></td>
          <td [ngClass]="{
                'destroyedClass': (accident && aircraft.aircraftDamage && aircraft.aircraftDamage.includes('Destroyed')),
                'substantialClass': (accident && aircraft.aircraftDamage && aircraft.aircraftDamage.includes('Substantial'))
              }">
            {{ aircraft.aircraftDamage }}
          </td>
        </tr>
        <tr>
          <td><b>Injury Severity</b></td>
          <td [ngClass]="{
            'fatal-injury': (accident.injurySeverity.includes('Fatal (')),
            'non-fatal-injury': (accident.injurySeverity === 'Non-Fatal'),
            'serious-injury': (accident.injurySeverity === 'Serious'),
            'minor-injury': (accident.injurySeverity === 'Minor')
            }">
            {{ accident.injurySeverity }}
          </td>
          <td><b>Airport</b></td>
          <td> {{ accident.airportName }} {{ accident.airportCode }}</td>
        </tr>
        <tr>
          <td><b>Aircraft Category</b></td>
          <td>{{ aircraft.aircraftCategory }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr *ngIf="aircraft.schedule || aircraft.purposeOfFlight">
          <td><b>Schedule</b></td>
          <td>{{ aircraft.schedule }}</td>
          <td><b>Purpose of Flight</b></td>
          <td> {{ aircraft.purposeOfFlight }}</td>
        </tr>
        <tr *ngIf="aircraft.operator || accident.weatherCondition">
          <td><b>Operator</b></td>
          <td>{{ aircraft.operator }}</td>
          <td><b>Weather Condition</b></td>
          <td> {{ accident.weatherCondition }}</td>
        </tr>
        <tr *ngIf="accident.latitude || accident.longitude">
          <td><b>Latitude</b></td>
          <td>{{ accident.latitude }}</td>
          <td><b>Longitude</b></td>
          <td>{{ accident.longitude }}</td>
        </tr>
        </table>
</div>

    <!---------- INJURIES ----------->
    <div *ngIf="accident && (accident.totalFatalInjuries || accident.totalSeriousInjuries || accident.totalMinorInjuries || accident.totalUninjured)">
      <table class='table table-striped'>
        <thead>
          <tr>
            <th class="fatalHeader">
              Fatal
            </th>
            <th class="seriousHeader">
              Serious
            </th>
            <th class="minorHeader">
              Minor
            </th>
            <th class="uninjuredHeader">
              Uninjured
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              {{ accident.totalFatalInjuries || 0 }}
            </td>
            <td>
              {{ accident.totalSeriousInjuries || 0 }}
            </td>
            <td>
              {{ accident.totalMinorInjuries || 0 }}
            </td>
            <td>
              {{ accident.totalUninjured || 0 }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!narrativeLoaded">
      <div class="loadingContainer">
        <app-svg-spinner></app-svg-spinner>
        <span class="loadingText">Loading the full report information ... please wait.</span>
      </div>
    </div>

    <div *ngIf="narrative">

      <div *ngIf="narrative.factualNarrative">
        <h4>Factual Narrative</h4>
        <p class="narrative">{{ narrative.factualNarrative }}</p>
      </div>

      <div *ngIf="narrative.narrativeSummary">
        <h4>Narrative Summary</h4>
        <p class="narrative">{{ narrative.narrativeSummary }}</p>
      </div>

      <div *ngIf="narrative.probableCause">
        <h4>Probably Cause</h4>
        <p class="narrative">{{ narrative.probableCause }}</p>
      </div>

    </div>

      <!--- GOOGLE MAP --->
      <div *ngIf="accident && accident.latitude && accident.longitude">
        <div class="map-container">
          <div class="map">
            <h2>
              <span class="mapHeader">Accident Location</span><small class="text-muted">{{ accident.latitude}} / {{accident.longitude}}</small>
            </h2><div class="card mt-3">
              <div class="card-body">
                <div #mapRef class="mapStyle"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <br />

      <div *ngIf="aircraftImage && this.aircraft">

        <h2>
          <span class="mapHeader">Aircraft Image</span>
          <span *ngIf="accident">
            <small class="text-muted">
              <span>{{ aircraft.make }} {{ aircraft.model }}</span>
              <span *ngIf="aircraftImage && aircraftRenamed">
                <span class="aircraftAlternateName">
                  ({{ aircraftImage.renamedAircraft }})
                </span>
              </span>
            </small>
          </span>
        </h2>

        <div class="card mt-3">
          <div class="card-body">
            <img *ngIf="aircraftImage && aircraftImage.imageUrl" src="{{ aircraftImage.imageUrl }}" class="aircraftImage">
            <div *ngIf="aircraftImage && !aircraftImage.imageUrl || !aircraftImage.imageUrl.includes('wikipedia')">
              <p>No image found for {{ aircraft.make }} {{aircraft.model}}.  We'll get one!</p>
            </div>
          </div>
        </div>

      </div>

      <p class="p-3">
        <small><a [routerLink]="['/accidents']">&lt;- Back to Accident List</a></small>
      </p>

    </div>
  </div>

